<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Palettable â€“ Color Palette Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f9fafb}
.container{max-width:48rem;margin:0 auto;padding:1.5rem}
.card{background:#fff;padding:1.5rem;border-radius:.75rem;box-shadow:0 1px 3px rgba(0,0,0,.1)}
.text-center{text-align:center}
.mb-6{margin-bottom:1.5rem}
.mb-4{margin-bottom:1rem}
.flex{display:flex;justify-content:space-between;align-items:center}
.input-container{position:relative}
.color-icon{width:1.25rem;height:1.25rem;border-radius:.25rem;border:1px solid #d1d5db;cursor:pointer;position:absolute;left:.75rem;top:.75rem}
.input{width:100%;padding:.75rem 1rem .75rem 2.5rem;border:1px solid #d1d5db;border-radius:.5rem;font-family:monospace}
.select{width:100%;padding:.75rem;border-radius:.5rem;border:1px solid #d1d5db}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.btn{padding:.75rem 1.25rem;border-radius:.5rem;border:none;cursor:pointer}
.btn-primary{background:#3b82f6;color:#fff}
.btn-secondary{background:#fff;border:1px solid #d1d5db}
.btn:disabled{opacity:.5;cursor:not-allowed}

.palette-container{margin-top:1rem;background:#fff;border-radius:.75rem;overflow:hidden}
.palette-colors{display:flex;height:120px}
.palette-color{flex:1;position:relative;cursor:pointer;transition:transform .25s, opacity .25s}
.palette-color.changed{
  animation: pulse .35s ease-out;
}
@keyframes pulse{
  0%{transform:scale(.96);opacity:.6}
  100%{transform:scale(1);opacity:1}
}
.lock-icon{position:absolute;top:.5rem;right:.5rem;background:#000;color:#fff;font-size:.7rem;padding:.15rem .35rem;border-radius:.25rem}
.color-hex{position:absolute;bottom:.5rem;left:50%;transform:translateX(-50%);background:#000;color:#fff;font-size:.7rem;padding:.2rem .4rem;border-radius:.25rem}
.palette-info{padding:1rem}
.palette-meta{font-size:.85rem;color:#6b7280;margin-bottom:.5rem}
.palette-actions{display:flex;gap:.5rem}
.footer-note{text-align:center;font-size:.8rem;color:#6b7280;margin-top:1.5rem}

/* Picker */
.color-picker{
  position:absolute;
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:.5rem;
  padding:.5rem;
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:.5rem;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  z-index:1000;
}
.color-swatch{
  width:26px;height:26px;border-radius:.25rem;
  border:1px solid #d1d5db;cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

<div class="text-center mb-6">
<img src="logo_palettable.png" width="150">
</div>

<div class="card mb-6">
<h3 class="mb-4">Palette Builder</h3>

<div class="flex mb-2">
<strong>Dominant Color</strong>
<span style="font-size:.85rem;color:#6b7280">Click icon to change</span>
</div>

<div class="input-container mb-4">
<div id="colorIcon" class="color-icon"></div>
<input id="colorInput" class="input" value="3">
</div>

<div class="form-row mb-4">
<select id="paletteSize" class="select">
<option value="2" selected>2 colors</option>
<option value="3">3 colors</option>
<option value="4">4 colors</option>
<option value="5">5 colors</option>
<option value="6">6 colors</option>
</select>

<select id="feelingSelect" class="select">
<option value="calm">Calm</option>
<option value="playful">Playful</option>
<option value="earthy">Earthy</option>
<option value="minimal">Minimal</option>
<option value="bold">Bold</option>
</select>
</div>

<div class="text-center">
<button id="generateBtn" class="btn btn-primary">Generate Palette</button>
</div>
</div>

<div id="resultsSection" style="display:none">
<div class="flex mb-2">
<strong>Generated Palette</strong>
<span style="font-size:.85rem;color:#6b7280">Tap colors to lock / unlock</span>
</div>
<div id="paletteContainer" class="palette-container"></div>
</div>

<div class="footer-note">
Colors may vary depending on the fabric used and can appear different from what you see on your screen.
</div>

</div>

<script>
const colorDatabase = Array.from({length:36},(_,i)=>({
  id:i+1,
  hex:[
    '#8A7EA6','#E6E2B2','#FCF1EF','#ECC7BA','#7C7C4A','#A05B5F',
    '#B3A569','#C2B356','#FEE1A1','#000000','#A24A63','#C3788D',
    '#5F5A3C','#5E7875','#8B3A3A','#7C774D','#7D8985','#6F625A',
    '#9EBAB5','#C9D6CF','#96928C','#877E72','#A3B2BB','#364A57',
    '#CD7C73','#839D77','#A47B67','#52684B','#7F3336','#D6CF8D',
    '#899064','#B15533','#00CFFF','#FF4FA3','#CCFF00','#FFF200'
  ][i]
}));

let dominantColor = 3;
let currentPalette = [];
let lockedColors = new Set();
let autoLockedColor = null;
let activePicker = null;
let history = [];

const el = id => document.getElementById(id);

/* ---------- History ---------- */
function pushHistory(){
  history.push({
    palette: currentPalette.map(c => c.id),
    locks: [...lockedColors],
    dominant: dominantColor
  });
}

function undo(){
  if(history.length < 2) return;
  history.pop();
  const last = history[history.length - 1];

  dominantColor = last.dominant;
  lockedColors = new Set(last.locks);
  currentPalette = last.palette.map(id => colorDatabase[id-1]);
  el('colorIcon').style.background = colorDatabase[dominantColor-1].hex;
  render([]);
}

/* ---------- Picker ---------- */
function openPicker(anchor){
  closePicker();
  const picker = document.createElement('div');
  picker.className = 'color-picker';

  picker.innerHTML = colorDatabase.map(c =>
    `<div class="color-swatch" data-id="${c.id}" style="background:${c.hex}"></div>`
  ).join('');

  const r = anchor.getBoundingClientRect();
  picker.style.top = r.bottom + window.scrollY + 8 + 'px';
  picker.style.left = r.left + window.scrollX + 'px';

  document.body.appendChild(picker);
  activePicker = picker;

  picker.onclick = e => {
    if (!e.target.dataset.id) return;
    dominantColor = parseInt(e.target.dataset.id);
    el('colorInput').value = dominantColor;
    el('colorIcon').style.background = colorDatabase[dominantColor-1].hex;

    lockedColors.delete(autoLockedColor);
    lockedColors.add(dominantColor);
    autoLockedColor = dominantColor;

    closePicker();
  };
}

function closePicker(){
  if(activePicker){
    activePicker.remove();
    activePicker = null;
  }
}

el('colorIcon').onclick = e => {
  e.stopPropagation();
  openPicker(el('colorIcon'));
};

/* ---------- Helpers ---------- */
function shuffle(a){
  const s=[...a];
  for(let i=s.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [s[i],s[j]]=[s[j],s[i]];
  }
  return s;
}

/* ---------- Palette ---------- */
function createPalette(){
  const size = parseInt(el('paletteSize').value);
  const locked = [...lockedColors].map(id => colorDatabase[id-1]);
  const slots = size - locked.length;
  let available = colorDatabase.filter(c => !lockedColors.has(c.id));
  shuffle(available);
  return [...locked, ...available.slice(0, slots)];
}

/* ---------- Render ---------- */
function render(previousIds=[]){
  closePicker();
  const allLocked = currentPalette.every(c => lockedColors.has(c.id));

  el('paletteContainer').innerHTML = `
    <div class="palette-colors">
      ${currentPalette.map(c => `
        <div class="palette-color ${previousIds.includes(c.id)?'':'changed'}"
             data-id="${c.id}" style="background:${c.hex}">
          ${lockedColors.has(c.id)?'<div class="lock-icon">ðŸ”’</div>':''}
          <div class="color-hex">#${c.id}</div>
        </div>
      `).join('')}
    </div>
    <div class="palette-info">
      <div class="palette-meta">
        ${lockedColors.size} of ${currentPalette.length} locked
      </div>
      <div class="palette-actions">
        <button id="undo" class="btn btn-secondary" ${history.length<2?'disabled':''}>Undo</button>
        <button id="regen" class="btn btn-secondary"
          ${allLocked ? 'disabled title="All colors are locked"' : ''}>
          Regenerate
        </button>
        <button id="send" class="btn btn-primary">Send</button>
      </div>
    </div>
  `;

  document.querySelectorAll('.palette-color').forEach(elm=>{
    elm.onclick = ()=>{
      const id = parseInt(elm.dataset.id);
      lockedColors.has(id) ? lockedColors.delete(id) : lockedColors.add(id);
      render(currentPalette.map(c=>c.id));
    };
  });

  el('regen').onclick = ()=>{
    if(allLocked) return;
    const prev = currentPalette.map(c=>c.id);
    currentPalette = createPalette();
    pushHistory();
    render(prev);
  };

  el('undo').onclick = undo;

  el('send').onclick = ()=>{
    const ids=currentPalette.map(c=>c.id).join(', ');
    navigator.clipboard.writeText(ids);
    window.open(`https://wa.me/919828601666?text=${encodeURIComponent(
      'Hi Creatis â€” here is my palette: '+ids
    )}`,'_blank');
  };
}

/* ---------- Generate ---------- */
el('generateBtn').onclick = ()=>{
  closePicker();
  lockedColors.clear();
  lockedColors.add(dominantColor);
  autoLockedColor = dominantColor;

  currentPalette = createPalette();
  history = [];
  pushHistory();
  render([]);
  el('resultsSection').style.display = 'block';
};

el('colorIcon').style.background = colorDatabase[dominantColor-1].hex;
</script>
</body>
</html>
