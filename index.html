<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Palettable - Color Palette Generator</title>

<style>
/* (UI untouched except for picker â€” same as last version) */
/* ... styles omitted for brevity â€” assume identical to previous response ... */
</style>
</head>

<body>
<div class="container">

<!-- header -->
<div class="text-center mb-8">
<img src="logo_palettable.png" width="150" />
</div>

<!-- card -->
<div class="card mb-6">
<h3 class="font-semibold text-gray-900 mb-4">Palette Builder</h3>

<h4 class="font-medium text-gray-900 mb-2">Dominant Color</h4>

<div class="mb-4">
<div class="flex gap-2">
<div class="input-container">

<div id="colorIcon" class="color-icon"></div>

<input id="colorInput" class="input" value="3" />

<div id="colorPicker" class="color-picker hidden"></div>
</div>
</div>

<div id="colorError" class="error-text hidden">
Use colors 1â€“32 (Tap the swatch to choose visually)
</div>

<div id="colorInfo" class="color-info">
<div id="colorInfoName" class="color-info-name"></div>
<div class="color-info-details">
<div>Hex: <span id="colorInfoHex" class="color-info-hex"></span></div>
<div>Temperature: <span id="colorInfoTemp"></span></div>
</div>
</div>
</div>

<div class="form-row">
<div>
<label class="font-medium mb-2" style="display:block">Palette Size</label>
<select id="paletteSize" class="select">
<option value="2" selected>2 colors</option>
<option value="3">3 colors</option>
<option value="4">4 colors</option>
<option value="5">5 colors</option>
<option value="6">6 colors</option>
</select>
</div>

<div>
<label class="font-medium mb-2" style="display:block">What feeling?</label>
<select id="feelingSelect" class="select">
<option value="calm">Calm</option>
<option value="playful">Playful</option>
<option value="earthy">Earthy</option>
<option value="minimal">Minimal</option>
<option value="bold">Bold</option>
</select>
</div>
</div>

<div class="text-center mt-4">
<button id="generateBtn" class="btn btn-primary">Generate Palette</button>
</div>
</div>

<div id="resultsSection" class="hidden">
<div class="flex justify-between mb-4">
<h3 class="font-semibold">Generated Palette</h3>
<div class="text-sm text-gray-600">Click colors to lock/unlock</div>
</div>

<div id="paletteContainer" class="palette-container"></div>
</div>

<div id="messageBox" class="message-box message-success hidden">
<span id="messageText"></span>
</div>

</div>

<script>
/* data (unchanged) */
const colorDatabase = [
/* â€” 1 to 32 entries â€” same as previous version â€” */
{id:1,name:'Lilac Taupe',hex:'#8A7EA6',family:'cool',feeling:['calm','minimal']},
{id:2,name:'Pale Champagne',hex:'#E6E2B2',family:'warm',feeling:['calm','minimal']},
{id:3,name:'Petal Pink',hex:'#FCF1EF',family:'warm',feeling:['calm','minimal']},
/* ... continue same list to 32 ... */
{id:32,name:'Tomato Cream',hex:'#B15533',family:'warm',feeling:['bold','earthy']}
];

/* state */
let lockedColors = new Set();
let currentPalette = [];
let dominantColor = 3;
let autoLockedColor = null;   // <<< new â€” tracks which color we auto-locked

/* helpers */
const el = id => document.getElementById(id);

function showMessage(t){
el('messageText').textContent = t;
el('messageBox').classList.remove('hidden');
setTimeout(()=>el('messageBox').classList.add('hidden'),2000);
}

function validateColor(id) {
const c = colorDatabase.find(c => c.id == id);
if (!c) {
el('colorError').classList.remove('hidden');
return false;
}

el('colorError').classList.add('hidden');
dominantColor = c.id;
el('colorIcon').style.background = c.hex;
el('colorInfoName').textContent = c.name;
el('colorInfoHex').textContent = c.hex;
el('colorInfoTemp').textContent = c.family;

/* -------- AUTO-LOCK BEHAVIOR (fixed) --------
   remove old autolock, apply new autolock   */
if (autoLockedColor !== null && lockedColors.has(autoLockedColor)) {
lockedColors.delete(autoLockedColor);
}

lockedColors.add(dominantColor);
autoLockedColor = dominantColor;

return true;
}

/* picker setup */
(function buildPicker(){
const box = el('colorPicker');
box.innerHTML = colorDatabase.map(c =>
`<div class="color-swatch" data-id="${c.id}" style="background:${c.hex}"></div>`
).join('');

box.addEventListener('click', e => {
if (!e.target.dataset.id) return;
el('colorInput').value = e.target.dataset.id;
validateColor(e.target.dataset.id);
box.classList.add('hidden');
});
})();

el('colorIcon').addEventListener('click', () =>
el('colorPicker').classList.toggle('hidden')
);

/* palette engine */
function shuffle(a){const s=[...a];for(let i=s.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[s[i],s[j]]=[s[j],s[i]];}return s;}

function createPalette() {
const size = parseInt(el('paletteSize').value);
const feeling = el('feelingSelect').value;
const dom = colorDatabase.find(c => c.id === dominantColor);

let palette = [...Array.from(lockedColors)].map(id =>
colorDatabase.find(c => c.id === id)
);

/* make sure dominant is present */
if (!lockedColors.has(dom.id)) palette.unshift(dom);

let available = colorDatabase.filter(c =>
!palette.some(p => p.id === c.id)
);

shuffle(available).forEach(c=>{
if (c.feeling?.includes(feeling) && palette.length < size)
palette.push(c);
});

available.forEach(c=>{
if (palette.length < size) palette.push(c);
});

return palette.slice(0,size);
}

function display(){
currentPalette = createPalette();

el('paletteContainer').innerHTML = `
<div class="palette-colors">
${currentPalette.map(c => `
<div class="palette-color ${lockedColors.has(c.id)?'locked':''}" data-id="${c.id}" style="background:${c.hex}">
${lockedColors.has(c.id)?'<div class="lock-icon">ðŸ”’</div>':''}
<div class="color-hex">#${c.id}</div>
</div>`).join('')}
</div>
<div class="palette-info">
<div class="palette-name">${el('feelingSelect').value} palette</div>
<div class="palette-description">${lockedColors.size} locked</div>
<div class="palette-actions">
<button class="btn btn-secondary btn-small" id="regen">Regenerate</button>
<button class="btn btn-primary btn-small" id="save">Save</button>
</div>
</div>`;

/* lock toggle */
document.querySelectorAll('.palette-color').forEach(elm=>{
elm.onclick = ()=>{
const id = parseInt(elm.dataset.id);

/* if user unlocks a previously auto-locked dominant,
   respect their choice */
if (lockedColors.has(id)) {
lockedColors.delete(id);
if (autoLockedColor === id) autoLockedColor = null;
} else {
lockedColors.add(id);
}

display();
};
});

el('regen').onclick = display;

el('save').onclick = ()=>{
navigator.clipboard
.writeText(currentPalette.map(c=>c.hex).join(', '))
.then(()=>showMessage('Copied palette'));
};
}

/* events */
el('generateBtn').onclick = ()=>{
if (validateColor(dominantColor)) {
display();
el('resultsSection').classList.remove('hidden');
}
};

validateColor(dominantColor);
</script>
</body>
</html>
